-# app/views/segments/easy_targets.html.haml
- if @error
  %p{style: "color: red; font-weight: bold;"}= @error
  - if @rate_limited
    %p{style: "color: orange;"}
      The daily limit resets at midnight UTC.
      %br
      Tip: Segments are cached, so searching the same area again won't use API calls.

- if @max_pace.present?
  %p Filtering: KOM pace â‰¥ #{@max_pace} min/km

- if @segments.any?
  %table
    %thead
      %tr
        %th= sortable_link('name', 'Name')
        %th= sortable_link('distance', 'Distance')
        %th= sortable_link('kom_pace', 'KOM Pace')
        %th= sortable_link('ratio', 'Ratio')
        %th= sortable_link('distance_from_search', 'Distance from Search')
        %th Actions
    %tbody
      - @segments.each do |seg|
        %tr
          %td= link_to seg[:name], "https://www.strava.com/segments/#{seg[:id]}", target: "_blank"
          %td= "#{seg[:distance]}m"
          %td= "#{format_pace(seg[:kom_pace])} min/km"
          %td= "#{(seg[:difficulty_ratio] * 100).round}%"
          %td
            - if seg[:distance_from_search]
              = "#{seg[:distance_from_search].round(2)} km"
            - else
              %span{style: "color: grey;"} N/A
          %td
            = button_to "Refresh KOM", refresh_kom_segment_path(seg[:id]), method: :post
- elsif !@error
  %p No segments found matching your criteria.