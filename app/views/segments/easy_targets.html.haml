-# app/views/segments/easy_targets.html.haml
- if @error
  %p{style: "color: red; font-weight: bold;"}= @error

- if @max_pace.present?
  %p Filtering: KOM pace ≥ #{@max_pace} min/km

- if @segments.any?
  %table
    %thead
      %tr
        %th= sortable_link('name', 'Name')
        %th= sortable_link('distance', 'Distance')
        %th= sortable_link('kom_pace', 'KOM Pace')
        %th= sortable_link('ratio', 'Ratio')
        %th= sortable_link('distance_from_search', 'Distance from Search')
        %th Actions
    %tbody
      - @segments.each do |seg|
        %tr{class: seg[:background_color_class]}
          %td= link_to seg[:name], "https://www.strava.com/segments/#{seg[:id]}", target: "_blank"
          %td= "#{seg[:distance]}m"
          %td= "#{format_pace(seg[:kom_pace])} min/km"
          %td= "#{(seg[:difficulty_ratio] * 100).round}%"
          %td
            - if seg[:distance_from_search]
              = "#{seg[:distance_from_search].round(2)} km"
            - else
              %span{style: "color: grey;"} N/A
          %td
            .segment-actions
              = button_to "✓", mark_done_segment_path(seg[:id]), method: :post, class: "btn btn-done #{'active' if seg[:is_done]}", title: "Mark as Done"
              = button_to "★", mark_favorited_segment_path(seg[:id]), method: :post, class: "btn btn-favorite #{'active' if seg[:is_favorited]}", title: "Mark as Favorite"
              = button_to "✗", mark_unavailable_segment_path(seg[:id]), method: :post, class: "btn btn-unavailable #{'active' if seg[:is_unavailable]}", title: "Mark as Unavailable"
              = button_to "Refresh KOM", refresh_kom_segment_path(seg[:id]), method: :post, class: "btn btn-primary"
- elsif !@error
  %p No segments found matching your criteria.